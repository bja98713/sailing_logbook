{% extends 'base.html' %}

{% block title %}D√©tail voyage ‚Äî Logbook{% endblock %}

{% block head_extra %}
  <style>.media-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}.media-card{border:1px solid #eee;padding:8px;border-radius:8px}img{max-width:100%;height:auto;border-radius:6px}</style>
{% endblock %}

{% block content %}
  <p><a href="/voyages/">‚Üê Retour</a></p>
  <h2>{{ object.departure_port }} ‚Üí {{ object.arrival_port }}</h2>
  <p>
    <a href="{% url 'voyage_edit' object.pk %}">‚úèÔ∏è Modifier</a>
    ¬∑
    <a href="{% url 'voyage_delete' object.pk %}">üóëÔ∏è Supprimer</a>
  </p>
  {% if object.cover_photo %}<p><img src="{{ object.cover_photo.url }}" alt="Cover"></p>{% endif %}
  <p><strong>D√©part :</strong> {{ object.start_datetime }} | <strong>Arriv√©e :</strong> {{ object.end_datetime }}</p>
  <p><strong>Positions :</strong> {{ object.start_position }} ‚Üí {{ object.end_position }}</p>
  <p><strong>Distance :</strong> {{ object.distance_nm }} NM | <strong>Vitesse moy :</strong> {{ object.avg_speed_kn }} kn</p>
  <p><strong>M√©t√©o :</strong> {{ object.weather }} | <strong>Vent :</strong> {{ object.wind }} | <strong>Mer :</strong> {{ object.sea_state }}</p>
  <p><strong>Moteur :</strong> {{ object.engine_hours }} h | <strong>Carburant :</strong> {{ object.fuel_liters }} L</p>
  <p><strong>√âquipage :</strong> {% for m in object.crew.all %}{{ m.full_name }}{% if not forloop.last %}, {% endif %}{% empty %}‚Äî{% endfor %}</p>

  <h3>Notes</h3><p style="white-space: pre-wrap">{{ object.notes }}</p>

  <h3>Maintenance li√©e</h3>
  <ul>{% for m in object.maintenance.all %}
    <li>{{ m.date }} ‚Äì {{ m.get_equipment_display }} : {{ m.description|truncatechars:80 }}</li>
  {% empty %}<li>‚Äî</li>{% endfor %}</ul>

  <h3>M√©dias</h3>
  <div class="media-grid">
    {% for media in object.media_assets.all %}
      <div class="media-card">
        {% if media.image %}<img src="{{ media.image.url }}" alt="{{ media.caption }}">{% endif %}
        <p>{{ media.caption }}</p>
        {% if media.file %}<a href="{{ media.file.url }}">T√©l√©charger</a>{% endif %}
      </div>
    {% empty %}<p>Aucun m√©dia.</p>{% endfor %}
  </div>

  <h4>Ajouter un m√©dia</h4>
  <form action="/voyages/{{ object.pk }}/upload/" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <label>Type</label>
    <select name="kind"><option value="photo">Photo</option><option value="video">Vid√©o (fichier)</option></select>
    <label>Image</label><input type="file" name="image" accept="image/*">
    <label>Fichier</label><input type="file" name="file">
    <label>L√©gende</label><input type="text" name="caption">
    <button type="submit">Uploader</button>
  </form>
{% endblock %}

<!doctype html><html lang="fr"><head><meta charset="utf-8"><title>D√©tail voyage</title>
<link rel="stylesheet" href="/static/base.css">
<style>.media-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}.media-card{border:1px solid #eee;padding:8px;border-radius:8px}img{max-width:100%;height:auto;border-radius:6px}</style>
</head><body>
<p><a href="/voyages/">‚Üê Retour</a></p>
<h1>{{ object.departure_port }} ‚Üí {{ object.arrival_port }}</h1>
<p>
  <a href="{% url 'voyage_edit' object.pk %}">‚úèÔ∏è Modifier</a>
  ¬∑
  <a href="{% url 'voyage_delete' object.pk %}">üóëÔ∏è Supprimer</a>
</p>
{% if object.cover_photo %}<p><img src="{{ object.cover_photo.url }}" alt="Cover"></p>{% endif %}
<p><strong>D√©part :</strong> {{ object.start_datetime }} | <strong>Arriv√©e :</strong> {{ object.end_datetime }}</p>
<p><strong>Positions :</strong> {{ object.start_position }} ‚Üí {{ object.end_position }}</p>
<p><strong>Distance :</strong> {{ object.distance_nm }} NM | <strong>Vitesse moy :</strong> {{ object.avg_speed_kn }} kn</p>
<p><strong>M√©t√©o :</strong> {{ object.weather }} | <strong>Vent :</strong> {{ object.wind }} | <strong>Mer :</strong> {{ object.sea_state }}</p>
<p><strong>Moteur :</strong> {{ object.engine_hours }} h | <strong>Carburant :</strong> {{ object.fuel_liters }} L</p>
<p><strong>√âquipage :</strong> {% for m in object.crew.all %}{{ m.full_name }}{% if not forloop.last %}, {% endif %}{% empty %}‚Äî{% endfor %}</p>
<h3>Notes</h3><p style="white-space: pre-wrap">{{ object.notes }}</p>

<h3>Maintenance li√©e</h3>
<ul>{% for m in object.maintenance.all %}
  <li>{{ m.date }} ‚Äì {{ m.get_equipment_display }} : {{ m.description|truncatechars:80 }}</li>
{% empty %}<li>‚Äî</li>{% endfor %}</ul>

<h3>M√©dias</h3>
<div class="media-grid">
{% for media in object.media_assets.all %}
  <div class="media-card">
    {% if media.image %}<img src="{{ media.image.url }}" alt="{{ media.caption }}">{% endif %}
    <p>{{ media.caption }}</p>
    {% if media.file %}<a href="{{ media.file.url }}">T√©l√©charger</a>{% endif %}
  </div>
{% empty %}<p>Aucun m√©dia.</p>{% endfor %}
</div>

<h4>Ajouter un m√©dia</h4>
<form action="/voyages/{{ object.pk }}/upload/" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <label>Type</label>
  <select name="kind"><option value="photo">Photo</option><option value="video">Vid√©o (fichier)</option></select>
  <label>Image</label><input type="file" name="image" accept="image/*">
  <label>Fichier</label><input type="file" name="file">
  <label>L√©gende</label><input type="text" name="caption">
  <button type="submit">Uploader</button>
</form>
</body></html>
